# Проектирование микрофронтов

Цель перехода на микрофронтенды:
* Ускорение time2market

Домены по DDD:
* Управление местами
* Управление профилем

Метод интеграции:
* run time, т.к. мы делим приложение на модули как раз для независимого их развертывания

Метод композиции:
* клиентская композиция, т.к. система уже так спроектирована и у нас нет причин переходить на серверный метод: нет потребности в оптимизации производительности и в seo-оптимизации

Инструмент реализации:
* webpack module federation, т.к. приложения используют общие зависимости. нам не требуется независимость от фреймворка, поэтому single spa мы не выбираем.

Стратегия межмодульного взаимодействия:
* уже используется context api в react для хранения пользователя

Части проекта:
* контейнер сборки (host)
* микрофронтенды по доменам:
  * управление местами (places-management)
  * управление профилем (profile-management)
* компоненты для ui, которые не используются в доменных модулях (technical-ui)
* общие файлы (shared)


# Ообоснование

За сборку будет отвечаеть часть host - она будет содержать основные компоненты (App.js, Main.js), которые необходимы, чтобы собрать все микрофронты. В ней будет и api, которые отрабатывают один раз при запуске приложения (getAppInfo(), getCardList(), getUserInfo()) и checkToken() из auth, потому что используется тоже только здесь. Для простоты решения, здесь будут блоки, которые используются только в App.js (content, page). В App.js осталась связующая логика по приложению, которую можно подумать вынести отдельно в случае усложнения хоста, например в контекст. Main.js распилен на два домена - на места и на профиль (о доменах дальше).

Отдельный модуль shared содержит общие компоненты, которые используют другие микрофронты, в нашем случае это PopupWithForm.js и настройки для api, которые общие для всех микрофронтендов. Здесь же и контекст, который так же общий (CurrentUserContext.js) и блок popup.

Техничейский модуль technical-ui содержит компоненты, которые нельзя отнести к бизнес-домену, но которые нужны для почти каждого сайта - Header.js, Footer.js, Login.js, InfoTooltip.js, ProtectedRoute.js, Register.js. Их не используют другие микрофронтенды, поэтому они не попадают в shared. Авторизация происходит тоже тут.

По DDD мы выделили places-management и profile-management. Лайки не выделяем в отдельный модуль, т.к. сильно связаны с местами, да и не имеют сейчас сложной логики.

Первый доменный модуль profile-management содержит компоненты по профилям EditAvatarPopup.js, EditProfilePopup.js и связанные зависимости.

Второй доменные модуль places-management содержит компоненты по местам AddPlacePopup.js, Card.js, ImagePopup.js и связанные зависимости.


# Запуск фронта
docker compose up

p.s. есть баги

# Микросервисы

Разделяем микросервисы по ДДД. Сервисы общаются через брокера сообщений, событиями. Для управления процессами используем оргестраторы, под каждый бизнес процесс можем выделять отдельного оркестратора, чтобы не усложнять один сервис.

Фронт разбиваем на микрофронтенды, общаемся с сервисами через API Gateway и BFF. API Gateway логирует, пишет аудит, балансирует нагрузку, аутентифицирует и авторизует пользоваения с помощью сервиса безопасности, а также собирует данные для мониторинга и аналитики - пишет в брокера события.

Сервис мониторинга читает нужные события и сохраняет у себя в колоночную базу данных. Эти данные не будут менятся и к ним будет быстрый доступ.

Интеграцию с платежными системами делает отдельный сервис. Под каждую внешнюю платежную систему делаем адаптер, который будет защищать нас от поломки внешнего сервиса и инкапсулировать логику интеграции.

https://disk.yandex.ru/d/zM2qlHPInb1aYA





